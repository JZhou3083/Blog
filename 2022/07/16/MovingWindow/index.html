<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="IntroMoving window is the type of questions that has a specified size $k$ of window skim across an array, performing filtering on the numbers such as averaging or finding local maximum value. It is st">
<meta property="og:type" content="article">
<meta property="og:title" content="Moving Window">
<meta property="og:url" content="https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/index.html">
<meta property="og:site_name" content="SeaNote">
<meta property="og:description" content="IntroMoving window is the type of questions that has a specified size $k$ of window skim across an array, performing filtering on the numbers such as averaging or finding local maximum value. It is st">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://www.openbookproject.net/books/pythonds/_images/percUp.png">
<meta property="og:image" content="http://www.openbookproject.net/books/pythonds/_images/percDown.png">
<meta property="article:published_time" content="2022-07-16T02:48:45.000Z">
<meta property="article:modified_time" content="2022-07-16T17:00:52.088Z">
<meta property="article:author" content="Jing Zhou">
<meta property="article:tag" content="Data Structure">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.openbookproject.net/books/pythonds/_images/percUp.png">
    
    
      
        
          <link rel="shortcut icon" href="/Blog/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/Blog/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/Blog/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Moving Window</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/Blog/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/Blog/">Home</a></li><!--
     --><!--
       --><li><a href="/Blog/about/">About</a></li><!--
     --><!--
       --><li><a href="/Blog/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/JZhou3083">Projects</a></li><!--
     --><!--
       --><li><a href="/Blog/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/Blog/2022/07/15/MonotonicStack/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/&text=Moving Window"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/&title=Moving Window"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/&is_video=false&description=Moving Window"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Moving Window&body=Check out this article: https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/&title=Moving Window"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/&title=Moving Window"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/&title=Moving Window"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/&title=Moving Window"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/&name=Moving Window&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/&t=Moving Window"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Intro"><span class="toc-number">1.</span> <span class="toc-text">Intro</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Question"><span class="toc-number">1.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Thinking"><span class="toc-number">1.2.</span> <span class="toc-text">Thinking</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Priority-queue"><span class="toc-number">2.</span> <span class="toc-text">Priority queue</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Complete-Binary-Tree"><span class="toc-number">2.1.</span> <span class="toc-text">Complete Binary Tree</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution"><span class="toc-number">2.2.</span> <span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Monotonic-dequeue"><span class="toc-number">3.</span> <span class="toc-text">Monotonic dequeue</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Moving Window
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Jing Zhou</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-07-16T02:48:45.000Z" itemprop="datePublished">2022-07-16</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/Blog/tags/Data-Structure/" rel="tag">Data Structure</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h1><p>Moving window is the type of questions that has a specified size $k$ of window skim across an array, performing filtering on the numbers such as averaging or finding local maximum value. It is straightforward to update the maximal value when a new number is added to the array iteratively whereas removing a value at the same time complex the problem.</p>
<h2 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h2><p>You are given an array of integers nums, there is a sliding window of size k which is moving from the very left of the array to the very right. You can only see the k numbers in the window. Each time the sliding window moves right by one position. Return the max sliding window.</p>
<p>Example:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Input: nums = [1,3,-1,-3,5,3,6,7], k = 3</span><br><span class="line">Output: [3,3,5,5,6,7]</span><br><span class="line">Explanation:</span><br><span class="line">Window position                Max</span><br><span class="line">---------------               -----</span><br><span class="line">[1  3  -1] -3  5  3  6  7       3</span><br><span class="line"> 1 [3  -1  -3] 5  3  6  7       3</span><br><span class="line"> 1  3 [-1  -3  5] 3  6  7       5</span><br><span class="line"> 1  3  -1 [-3  5  3] 6  7       5</span><br><span class="line"> 1  3  -1  -3 [5  3  6] 7       6</span><br><span class="line"> 1  3  -1  -3  5 [3  6  7]      7</span><br></pre></td></tr></table></figure>

<h2 id="Thinking"><a href="#Thinking" class="headerlink" title="Thinking"></a>Thinking</h2><p>The first idea of solving this problem is Brute Force which has time complexity as $O(nk)$ and $O(1)$. In this case repetitive comparing is performed unless the hopping size is smaller than 3 (Think about that at step $i$, the comparison between $nums[i+1]$ and $nums[]$ will be conducted again at iteration $i+1$).</p>
<p>Two data structures are good solutions to this problem as they allow easy maximal value finding when element-wise updating happens: priority queue (heap) and monotonic queue. Python provides packages for them both(heapq &amp; collections.deque) for use but it is good to understand the working mechanisms. This note will go through both structures in a bottom-up way.</p>
<h1 id="Priority-queue"><a href="#Priority-queue" class="headerlink" title="Priority queue"></a>Priority queue</h1><p>Priority queue acts like a queue in that you dequeue an item by removing it from the front. However, in a priority queue the logical order of items inside a queue is determined by their priority. Thus when a new item joins the priority queue, it may move its way up until the front, which is a useful property for many applications such as sorting problems.</p>
<h2 id="Complete-Binary-Tree"><a href="#Complete-Binary-Tree" class="headerlink" title="Complete Binary Tree"></a>Complete Binary Tree</h2><p>Although a priority queue can be implemented using $list$ with sorting functions, inserting into a list is $O(n)$ and sorting is $O(nlogn)$. Meanwhile, a binary heap allows both enqueue and dequeue items in $O(logn)$ hence is usually more popular.</p>
<p>It is worth noting that a binary heap diagram looks like a tree but the actual structure is an array(usually a list in Python). This is because the index of its elements follow strictly the structure of a $complete binary tree$, where all levels except the deepest are fully filled and the nodes of the lowest are filled from left to right. An extra property for heap is either the key stored in each node is greater&#x2F;equal than the keys in the node’s children (Max heap) or small&#x2F;equal(Min heap).</p>
<p>The advantage of a complete binary tree is that it ensures a index relation between a parent node and all its children nodes: for any parent node $i$, it’s left node and right node (if exists) are at the index of $2i+1$ and $2i+2$. Reversely, for any node, its parent node’s index is $(i-1)&#x2F;&#x2F;2$(if i&#x3D;0 is the root node). This property make it very convenient for traversing tree nodes following the relations.</p>
<p>Now the issue is to maintain the property in the queue and dequeue operations. After inserting a new element, for example, it compare the value of the new element $nums[i]$ with its parent node nums[(i-1)&#x2F;&#x2F;2] and if the relation violates the property, they switch position. The comparison and switching keep happening until the property is restored:</p>
<p><img src="http://www.openbookproject.net/books/pythonds/_images/percUp.png" alt="Adding element"></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># restore the property after a new element is inserted at the ith --- max heap</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">perc_up</span>(<span class="params">self, i</span>):</span><br><span class="line">  <span class="keyword">while</span> (i-<span class="number">1</span>) // <span class="number">2</span> &gt; <span class="number">0</span>: <span class="comment"># Assuming the tree and the array share the index and root index i=0</span></span><br><span class="line">    <span class="keyword">if</span> self.heap_list[i] &gt; self.heap_list[(i-<span class="number">1</span>)//<span class="number">2</span>]:</span><br><span class="line">       <span class="comment"># The new element larger than its parent</span></span><br><span class="line">       tmp = self.heap_list[(i-<span class="number">1</span>)//<span class="number">2</span>]</span><br><span class="line">       self.heap_list[(i-<span class="number">1</span>)//<span class="number">2</span>] = self.heap_list[i]</span><br><span class="line">       self.heap_list[i] = tmp</span><br><span class="line">       i = (i-<span class="number">1</span>) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">insert</span>(<span class="params">self,k</span>):</span><br><span class="line">  self.heap_list.append(k)</span><br><span class="line">  self.current_size = self.current_size+<span class="number">1</span></span><br><span class="line">  self.perc_up(self.current_size)</span><br></pre></td></tr></table></figure>
<p>Removing the head(maximum) of the heap follows the steps:</p>
<ul>
<li>Remove the root node</li>
<li>pop out the end of the queue and replace as the root</li>
<li>compare the value of the new root with its children and switch its position with the child node with greater value.</li>
<li>continue the previous step until the order is restored.</li>
</ul>
<p><img src="http://www.openbookproject.net/books/pythonds/_images/percDown.png" alt="dequeue"></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># restore the property after removing the head</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">perc_down</span>(<span class="params">self, i</span>):</span><br><span class="line">  <span class="comment">#The i is not necessarily the root nodes, root node index is 0</span></span><br><span class="line">  <span class="keyword">while</span> <span class="number">2</span>*i+<span class="number">1</span> &lt;= self.current_size:</span><br><span class="line">    mc = self.max_child(i)</span><br><span class="line">    <span class="keyword">if</span> self.heap_list[i.] &lt; self.heap_list[mc]:</span><br><span class="line">      tmp = self.heap_list[mc]</span><br><span class="line">      self.heap_list[mc] = self.heap_list[i]</span><br><span class="line">      self.heap_list[i] = tmp</span><br><span class="line">    i = mc</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">max_child</span>(<span class="params">self, i</span>):</span><br><span class="line">  <span class="keyword">if</span> i*<span class="number">2</span>+<span class="number">2</span>&gt; self.current_size:</span><br><span class="line">    <span class="keyword">return</span> i*<span class="number">2</span>+<span class="number">1</span></span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">return</span> i*<span class="number">2</span>+<span class="number">1</span> <span class="keyword">if</span> self.heap_list[i*<span class="number">2</span>+<span class="number">1</span>]&gt;self.heap_list[i*<span class="number">2</span>+<span class="number">2</span>] <span class="keyword">else</span> i*<span class="number">2</span>+<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">del_head</span>(<span class="params">self</span>):</span><br><span class="line">  ret = self.heap_list[<span class="number">0</span>]</span><br><span class="line">  self.heap_list[<span class="number">0</span>] = self.heap_list[-<span class="number">1</span>]</span><br><span class="line">  self.current_size -=<span class="number">1</span></span><br><span class="line">  self.heap_list.pop()</span><br><span class="line">  self.perc_down(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">return</span> ret</span><br></pre></td></tr></table></figure>

<p>A powerful property of heap is for any element in the array, it only takes $logn$ times (the level numbers) of comparing and switching to ensure it is smaller&#x2F;greater than its parent node. Applied to every nodes, the time complexity of heap sorting is therefore $nlogn$ to an array.</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>Python provides $heapq$, which does the order restoring as above for us. We only need to take care of the FIFO tasks. As the default heapq in Python is minimum heap, we can create a new array with -nums[i] elements instead. The implementation is as below:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">maxSlidingWindow</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], k: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        n = <span class="built_in">len</span>(nums)</span><br><span class="line">        <span class="comment"># 注意 Python 默认的优先队列是小根堆</span></span><br><span class="line">        q = [(-nums[i], i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k)] <span class="comment"># value and index</span></span><br><span class="line">        heapq.heapify(q) <span class="comment">#Transform a list into a heap, in-place, in linear time</span></span><br><span class="line"></span><br><span class="line">        ans = [-q[<span class="number">0</span>][<span class="number">0</span>]]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k, n):</span><br><span class="line">            heapq.heappush(q, (-nums[i], i)) <span class="comment"># Push while maintaining the heap invariant</span></span><br><span class="line">            <span class="keyword">while</span> q[<span class="number">0</span>][<span class="number">1</span>] &lt;= i - k:</span><br><span class="line">                heapq.heappop(q) <span class="comment"># pop and return the smallest item from the heap</span></span><br><span class="line">            ans.append(-q[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ans</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>The time complexity of solution is $O((n-k)*logn)$ because the worst case is k&gt;n and pushing and poping an element are both $O(logn)$ (Actually from maintaining the heap invariant). Space complexity is $O(n)$.</p>
<h1 id="Monotonic-dequeue"><a href="#Monotonic-dequeue" class="headerlink" title="Monotonic dequeue"></a>Monotonic dequeue</h1><p>Removing the head of a list is $O(n)$ because the index of all elements need to shift a step backward. Dequeue is therefore implemented for convenience operations on both ends(operating on the middle is still $O(n)$).</p>
<p>Now re-think the problem: if we keeps a monotonically decreasing stack at iteration $i$, and at the step $i+1$ we compare the new element with the last element in the stack. If the new element is larger, the last element in the stack is no longer useful: if it cannot win the current iteration, it definetely will not win the next. So we can safely pop it out and replace it with the new element. Continue until the new element can be pushed as the tail of the stack then check if the head element is still in the window from the index. If it is still in, it is return as the answer of this round. If not, pop the head out and return the new head. To speed up the head popping, dequeue is used instead of stack.</p>
<p>Example:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">输入: nums = [1,3,-1,-3,5,3,6,7], 和 k = 3</span><br><span class="line">输出: [3,3,5,5,6,7]</span><br><span class="line"></span><br><span class="line">解释过程中队列中都是具体的值，方便理解，具体见代码。</span><br><span class="line">初始状态：L=R=0,队列:&#123;&#125;</span><br><span class="line">i=0,nums[0]=1。队列为空,直接加入。队列：&#123;1&#125;</span><br><span class="line">i=1,nums[1]=3。队尾值为1，3&gt;1，弹出队尾值，加入3。队列：&#123;3&#125;</span><br><span class="line">i=2,nums[2]=-1。队尾值为3，-1&lt;3，直接加入。队列：&#123;3,-1&#125;。此时窗口已经形成，L=0,R=2，result=[3]</span><br><span class="line">i=3,nums[3]=-3。队尾值为-1，-3&lt;-1，直接加入。队列：&#123;3,-1,-3&#125;。队首3对应的下标为1，L=1,R=3，有效。result=[3,3]</span><br><span class="line">i=4,nums[4]=5。队尾值为-3，5&gt;-3，依次弹出后加入。队列：&#123;5&#125;。此时L=2,R=4，有效。result=[3,3,5]</span><br><span class="line">i=5,nums[5]=3。队尾值为5，3&lt;5，直接加入。队列：&#123;5,3&#125;。此时L=3,R=5，有效。result=[3,3,5,5]</span><br><span class="line">i=6,nums[6]=6。队尾值为3，6&gt;3，依次弹出后加入。队列：&#123;6&#125;。此时L=4,R=6，有效。result=[3,3,5,5,6]</span><br><span class="line">i=7,nums[7]=7。队尾值为6，7&gt;6，弹出队尾值后加入。队列：&#123;7&#125;。此时L=5,R=7，有效。result=[3,3,5,5,6,7]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>And the code:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 单调双端队列 O(n)，O（k）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">maxSlidingWindow</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], k: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(nums) &lt; <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> nums</span><br><span class="line">        queue = collections.deque()</span><br><span class="line">        res = [<span class="number">0</span>] * (<span class="built_in">len</span>(nums)-k+<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)):</span><br><span class="line">            <span class="comment">#保证从大到小 如果前面数小则需要依次弹出，直至满足要求</span></span><br><span class="line">            <span class="keyword">while</span> queue <span class="keyword">and</span> nums[queue[-<span class="number">1</span>]] &lt;= nums[i]:</span><br><span class="line">                queue.pop()</span><br><span class="line">            queue.append(i)</span><br><span class="line">            <span class="comment">#判断队首值是否有效</span></span><br><span class="line">            <span class="keyword">if</span> queue[<span class="number">0</span>] &lt;= i - k:</span><br><span class="line">                queue.popleft()</span><br><span class="line">            <span class="comment">#当窗口长度为k时 保存当前窗口中最大值</span></span><br><span class="line">            <span class="keyword">if</span> i + <span class="number">1</span> &gt;= k:</span><br><span class="line">                res[i+<span class="number">1</span>-k] = nums[queue[<span class="number">0</span>]]</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<p>The time complexity is $O(n)$ and the space complexity is $O(k)$.</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/Blog/">Home</a></li>
         
          <li><a href="/Blog/about/">About</a></li>
         
          <li><a href="/Blog/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/JZhou3083">Projects</a></li>
         
          <li><a href="/Blog/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Intro"><span class="toc-number">1.</span> <span class="toc-text">Intro</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Question"><span class="toc-number">1.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Thinking"><span class="toc-number">1.2.</span> <span class="toc-text">Thinking</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Priority-queue"><span class="toc-number">2.</span> <span class="toc-text">Priority queue</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Complete-Binary-Tree"><span class="toc-number">2.1.</span> <span class="toc-text">Complete Binary Tree</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution"><span class="toc-number">2.2.</span> <span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Monotonic-dequeue"><span class="toc-number">3.</span> <span class="toc-text">Monotonic dequeue</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/&text=Moving Window"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/&title=Moving Window"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/&is_video=false&description=Moving Window"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Moving Window&body=Check out this article: https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/&title=Moving Window"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/&title=Moving Window"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/&title=Moving Window"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/&title=Moving Window"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/&name=Moving Window&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://jzhou3083.github.io/Blog/2022/07/16/MovingWindow/&t=Moving Window"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021-2022
    Jing Zhou
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/Blog/">Home</a></li><!--
     --><!--
       --><li><a href="/Blog/about/">About</a></li><!--
     --><!--
       --><li><a href="/Blog/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/JZhou3083">Projects</a></li><!--
     --><!--
       --><li><a href="/Blog/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/Blog/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
